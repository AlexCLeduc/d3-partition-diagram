{"version":3,"sources":["PartitionComponent/PartitionDataWrapper.js","PartitionComponent/util.tsx","PartitionComponent/PartitionDiagram.js","Example/data.ts","Example/PlainExample.tsx","App.tsx","reportWebVitals.ts","index.tsx"],"names":["PartitionDataWrapper","hierarchy","alternate_data_wrapper_node_rules","distinct_root_identifier","Date","getTime","data_wrapper_node_rules","node","__value__","value","open","how_many_to_show","_node","children","length","show","_","head","hide","tail","unhide","filter","__node","isUndefined","data","hide_item_by_default","Math","abs","concat","difference","get_id_ancestry","parent","id","each","id_ancestry","process_node_children_for_compression","this","root","levels","depth","push","chain","branches","map","source","target","flatten","descendants","isEmpty","last","hidden_children","to_be_shown","to_be_compressed","new_compressed_child","isFunction","take","takeRight","Object","assign","height","reduce","memo","x","sum","name","description","type","is","__type__","no_polygon","isArrayLike","d","unhidden_children","magnified","compressed","child","eachAfter","c","collapsed","is_placeholder","show_partial_children","factor","resize_children","some","hide_all_children","identity","forEach","restore","unhide_all_children","top_sibling","siblings","ancestors","absolute_value_sort","a","b","is_IE","constant","text_abbrev","text","length_value","substring","assign_colors_recursively","color","i","brighter","content_key","polygon_key","BasePartitionDiagram","container","options","configure_then_render","extend","colors","background_color","html","style","dont_fade","level_headers","formatter","root_text_func","default_html_func","should_add_value","html_func","render","keydown_dispatch","event","keyCode","click_dispatch","select","content","closest","isNull","classed","unmagnify_all","pop_up","remove_pop_up","stopImmediatePropagation","preventDefault","querySelector","contains","datum","DOM","className","includes","show_all_children","magnify","unmagnify","should_root_have_popup","add_pop_up","outer_html","svg","append","defs","graph_area","attr","on","transition","duration","links","to_open_levels","side_padding","col_width","total_width","keys","yscale","scaleLinear","domain","range","cycle_colors","vertical_placement_counters","key","fromPairs","horizontal_placement_counters","mapValues","vals","col0_width","selectAll","remove","sort","reverse","enter","has","html_content_join","exit","sel","cls","index","indexOf","top","rendered_height","width","merge","scaled_height","polygon_links","Map","floor","item_node","text_is_bigger_then_item","offsetHeight","content_height","parentElement","pixelHeight","font_size","top_vertical_margin","level","title","current_top","parent_top","diff","max","order","total_height","values","link_polygons","link","set","height_of_all_children","add_polygons","fade","unmagnify_all_popup","remove_unmagnify_all_button","are_any_children_magnified","add_unmagnify_all_button","vertical_counter","tr","tl","br","bl","klass","target_x","offsetLeft","target_y","target_height","source_x","source_height","left_side_padding","gradient_def_id","toString","replace","gradient_def","get","to_fade","isArray","lowest_node_id_ancestry","split_and_reverse_id_ancestry","split","lowest_node_id_ancestry_chunks","link_target_id_ancestry_chunks","longer_of_the_id_chunks","shorter_of_the_id_chunks","id_chunk","ix","bool","unfade_parent_polygons","polygon_selector","Error","focus","pop_up_top","offsetWidth","render_popup","calculated_middle","offsetTop","popup_pointer","pointer_height","absolute_pop_up_left","window","scroll","pageYOffset","to_be_highlighted","uniqBy","unfade_popup_parents","unfade","should_remove_unmagnify_all_button","undefined","ManualPartitionDiagram","popupCallback","generateNode","maxLevel","faker","datatype","uuid","findName","childrenCount","number","min","Array","from","amount","seed","setLocale","topLevelCount","generateHierarchy","PlainExample","DumbComponent","PartitionComponent","useRef","useEffect","containerSelection","partitionDiagram","popupHtmlForNode","partitionData","valueFunc","rawDataRoot","get_val","post_traversal_value_set","getData","htmlForNode","branchColors","backgroundColor","renderDiagram","current","ref","innerHTML","root_value","App","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.afe9f699.chunk.js","sourcesContent":["import { sum } from \"d3-array\";\nimport { hierarchy } from \"d3-hierarchy\";\nimport _ from \"lodash\";\n\nexport class PartitionDataWrapper {\n  constructor(hierarchy, alternate_data_wrapper_node_rules) {\n    const distinct_root_identifier = new Date().getTime();\n\n    const default_data_wrapper_node_rules = node => {\n      node.__value__ = node.value;\n      node.open = true;\n      node.how_many_to_show = function (_node) {\n        if (_node.children.length <= 2) {\n          return [_node.children, []];\n        }\n        const show = [_.head(_node.children)];\n        const hide = _.tail(_node.children);\n        const unhide = _.filter(hide, __node =>\n          !_.isUndefined(__node.data.hide_item_by_default) &&\n          __node.data.hide_item_by_default\n            ? false\n            : Math.abs(__node.value) > hierarchy.value / 100\n        );\n        return [show.concat(unhide), _.difference(hide, unhide)];\n      };\n    };\n\n    const data_wrapper_node_rules = alternate_data_wrapper_node_rules\n      ? alternate_data_wrapper_node_rules\n      : default_data_wrapper_node_rules;\n\n    const get_id_ancestry = node => {\n      if (node.parent && !_.isUndefined(node.parent.data.id)) {\n        return node.data.id + \"-\" + get_id_ancestry(node.parent);\n      } else {\n        return \"root:\" + distinct_root_identifier;\n      }\n    };\n\n    hierarchy\n      .each(node => data_wrapper_node_rules(node))\n      .each(node => (node.id_ancestry = get_id_ancestry(node)))\n      .each(\n        node =>\n          (node.children = this.process_node_children_for_compression(node))\n      );\n\n    this.root = hierarchy;\n  }\n  to_open_levels() {\n    const levels = {};\n    this.root.each(node => {\n      return (levels[node.depth] = levels[node.depth] || []).push(node);\n    });\n    return levels;\n  }\n  links() {\n    return _.chain(this.branches())\n      .map(source => source.children.map(target => ({ source, target })))\n      .flatten(true)\n      .value();\n  }\n  branches() {\n    return _.filter(\n      [this.root].concat(this.root.descendants()),\n      node => node.children\n    );\n  }\n  process_node_children_for_compression(node) {\n    if (!node.children || _.isEmpty(node.children)) {\n      return;\n    }\n    if (!_.isUndefined(_.last(node.children).data.hidden_children)) {\n      return node.children;\n    }\n    let to_be_shown, to_be_compressed, new_compressed_child, children;\n    if (_.isFunction(node.how_many_to_show)) {\n      [to_be_shown, to_be_compressed] = node.how_many_to_show(node);\n    } else {\n      if (node.how_many_to_show >= node.children.length) {\n        to_be_shown = node.children;\n        to_be_compressed = [];\n      } else {\n        to_be_shown = _.take(node.children, node.how_many_to_show);\n        to_be_compressed = _.takeRight(\n          node.children,\n          node.children.length - node.how_many_to_show\n        );\n      }\n    }\n    if (to_be_compressed.length > 0) {\n      new_compressed_child = Object.assign(hierarchy({}), {\n        height: node.height - 1,\n        depth: node.depth + 1,\n        id_ancestry:\n          _.reduce(\n            to_be_compressed,\n            (memo, x) => memo + \"-\" + x.data.id,\n            \"compressed>\"\n          ) +\n          \"-<compressed-\" +\n          node.id_ancestry,\n        open: true,\n        parent: node,\n        value: sum(to_be_compressed, x => x.value),\n        __value__: sum(to_be_compressed, x => x.value),\n        data: {\n          id: _.map(to_be_compressed, x => x.data.id) + \"compressed\",\n          name: \"+\",\n          description: \"\",\n          type: \"compressed\",\n          is: __type__ => __type__ === \"compressed\",\n          hidden_children: to_be_compressed,\n        },\n        no_polygon: false,\n      });\n      children = to_be_shown.concat(new_compressed_child);\n    } else {\n      children = to_be_shown;\n    }\n    return children;\n  }\n  show_partial_children(node) {\n    let children;\n    // get rid of the minimize placeholder node\n    node.children =\n      !_.isUndefined(node.children) &&\n      _.isArrayLike(node.children) &&\n      node.children.filter(d => _.isUndefined(d.data.unhidden_children));\n    if (node.children) {\n      node.children = children =\n        this.process_node_children_for_compression(node);\n    }\n    return children;\n  }\n  show_all_children(node) {\n    if (!this.magnified(node)) {\n      node.value = node.__value__;\n    }\n    if (node.children) {\n      let children;\n\n      const compressed = _.last(node.children);\n\n      if (!_.isUndefined(compressed.data.hidden_children)) {\n        children = node.children.concat(compressed.data.hidden_children);\n        compressed.data.unhidden_children = compressed.data.hidden_children;\n        delete compressed.data.hidden_children;\n        compressed.data.id = \"minimize\" + compressed.id_ancestry;\n        compressed.value = 1;\n        compressed.data.name = \"—\";\n        _.each(children, _node => {\n          _node.parent = node;\n        });\n        compressed.no_polygon = true;\n      } else {\n        children = node.children;\n      }\n\n      _.chain(children)\n        .difference(node.children)\n        .filter(node => node.value !== \"collapsed\")\n        .each(child => {\n          child.eachAfter(d => {\n            if (d.children) {\n              d.children = this.process_node_children_for_compression(d);\n            }\n          });\n        })\n        .value();\n\n      node.children = children;\n\n      node.eachAfter(c => {\n        if (!this.collapsed(c)) {\n          c.open = true;\n        }\n      });\n\n      return children;\n    }\n  }\n  hide_all_children(node) {\n    node.eachAfter(c => (c.open = c === node));\n  }\n  unhide_all_children(node) {\n    node.eachAfter(c => (c.open = true));\n  }\n  restore(node) {\n    if (!node.data.hidden_children && !node.data.unhidden_children) {\n      node.value = node.__value__;\n      this.show_partial_children(node);\n    } else if (\n      this.is_placeholder(node) &&\n      !_.isUndefined(node.data.hidden_children)\n    ) {\n      node.value = sum(node.data.hidden_children, child => child.__value__);\n    }\n  }\n  unmagnify(node) {\n    node.value = node.__value__;\n    const factor = 1 / node.magnified;\n    this.resize_children(node, factor);\n    node.value = node.__value__;\n    node.magnified = false;\n    const parent = node.parent;\n    if (!_.some(parent.children, d => d.magnified)) {\n      _.map(parent.children, _.identity).forEach(d => {\n        this.restore(d);\n        this.unhide_all_children(d);\n      });\n    } else {\n      node.value = 0;\n      this.hide_all_children(node);\n    }\n  }\n  magnify(node) {\n    const parent = node.parent;\n    const top_sibling = parent.children[0];\n    node.value = node.__value__;\n    let factor;\n    if (node.value > 0.7 * top_sibling.__value__) {\n      factor = 2;\n    } else {\n      factor = Math.abs(top_sibling.__value__ / node.__value__);\n    }\n    this.resize_children(node, factor);\n    node.magnified = factor;\n    const siblings = parent.children.filter(\n      d => d !== node && !this.magnified(d) && d.value !== \"collapsed\"\n    );\n    _.each(siblings, d => {\n      d.value = \"collapsed\";\n      this.hide_all_children(d);\n    });\n  }\n  resize_children(node, factor) {\n    node.value *= factor;\n    node.open = true;\n    if (node.children) {\n      _.each(node.children, d => {\n        this.resize_children(d, factor);\n      });\n    }\n    if (node.data.hidden_children) {\n      _.each(node.data.hidden_children, d => {\n        this.resize_children(d, factor);\n      });\n    }\n  }\n  is_placeholder(node) {\n    return node.data.hidden_children || node.data.unhidden_children;\n  }\n  collapsed(node) {\n    return _.some(node.ancestors(), d => d.value === \"collapsed\");\n  }\n  magnified(node) {\n    return _.some(node.ancestors(), d => d.magnified);\n  }\n}\n","import { sum } from \"d3-array\";\nimport _ from \"lodash\";\nimport ReactDOM from \"react-dom\";\n\nexport const absolute_value_sort = (a, b) =>\n  -(Math.abs(a.value) - Math.abs(b.value));\n\nexport const alphabetic_name_sort = (a, b) =>\n  a.data.name.toLowerCase().localeCompare(b.data.name.toLowerCase());\n\nexport function post_traversal_value_set(node, get_val) {\n  if (_.isEmpty(node.children)) {\n    node.value = get_val(node.data) || 0;\n  } else {\n    node.children = _.filter(\n      node.children,\n      d => d.value !== false && d.value !== 0\n    );\n    node.value = sum(node.children, d => d.value);\n  }\n}\n\nexport class ReactContentRenderer {\n  // used to cleanup react memory leaks\n  constructor() {\n    this.nodes = [];\n  }\n  render(component, node) {\n    ReactDOM.render(component, node);\n    this.nodes.push(node);\n  }\n  unmountAll() {\n    _.each(this.nodes, node => ReactDOM.unmountComponentAtNode(node));\n    this.nodes = [];\n  }\n  unmountAtNode(node) {\n    ReactDOM.unmountComponentAtNode(node);\n    this.nodes = this.nodes.filter(n => n === node);\n  }\n}\n","import React from \"react\";\nimport { sum } from \"d3-array\";\nimport { color } from \"d3-color\";\nimport { scaleLinear } from \"d3-scale\";\nimport { select } from \"d3-selection\";\nimport \"d3-transition\";\nimport _ from \"lodash\";\n\nimport { PartitionDataWrapper } from \"./PartitionDataWrapper.js\";\n\n/* eslint import/no-webpack-loader-syntax: off */\n// eslint-disable-next-line import/no-unresolved\nimport _styles from \"./PartitionDiagram.css\";\nimport { ReactContentRenderer } from \"./util\";\n\n// TODO: consider IE implications\nconst is_IE = _.constant(false);\n\n//TODO: taken from IB, extract to util\nexport const text_abbrev = function (text, length) {\n  const length_value = _.isFunction(length) ? length() : length || 60;\n\n  return text.length > length_value\n    ? text.substring(0, length_value - 4) + \"...\"\n    : text;\n};\n\nconst assign_colors_recursively = function (node, color) {\n  node.color = color;\n  if (_.isUndefined(node.children)) {\n    return;\n  }\n  _.each(node.children, (child, i) => {\n    assign_colors_recursively(child, color.brighter(0.15));\n  });\n};\nconst content_key = d => d.id_ancestry;\nconst polygon_key = d => d.target.id_ancestry;\n\nexport class BasePartitionDiagram {\n  constructor(container, options) {\n    this.options = options;\n    this.outer_html = container;\n    this.outer_html.html(`\n      <div class='partition-diagram-outer-area' aria-hidden='true'>\n         <div class='partition-diagram'></div>\n      </div>\n    `);\n    this.html = this.outer_html.select(\".partition-diagram\");\n\n    this.svg = this.html.append(\"div\").classed(\"__svg__\", true).append(\"svg\");\n\n    this.defs = this.svg.append(\"defs\");\n\n    this.graph_area = this.svg.append(\"g\").attr(\"class\", \"graph_area\");\n\n    this.html\n      .style(\"position\", \"relative\")\n      .style(\"zoom\", 0.4)\n      .on(\"keydown\", this.keydown_dispatch)\n      .on(\"click\", this.click_dispatch)\n      .transition()\n      .duration(500)\n      .style(\"zoom\", 1)\n      .on(\"end\", this.configure_then_render);\n  }\n  configure_then_render = (options = {}) => {\n    this.options = _.extend(this.options, options);\n\n    this.data = new PartitionDataWrapper(\n      this.options.data,\n      this.options.data_wrapper_node_rules\n    );\n\n    this.colors = this.options.colors;\n    this.background_color = this.options.background_color;\n    this.html.style(\"background-color\", this.background_color);\n\n    this.dont_fade = this.options.dont_fade || [];\n\n    this.level_headers = this.options.level_headers || false;\n\n    this.formatter = this.options.formatter || _.identity;\n    this.root_text_func = this.options.root_text_func || _.identity;\n    const default_html_func = d => {\n      const should_add_value =\n        Math.abs(d.value) / this.data.root.value > 0.02 &&\n        _.isUndefined(d.data.hidden_children);\n      let name;\n      if (should_add_value && d !== this.data.root) {\n        name = d.data.name + this.formatter(d);\n      } else if (!should_add_value && d !== this.data.root) {\n        name = text_abbrev(d.data.name, 80);\n      } else if (d === this.data.root) {\n        name = this.root_text_func(this.data.root.value);\n      }\n      return name;\n    };\n\n    this.options.html_func = this.options.html_func || default_html_func;\n\n    this.render();\n  };\n  render() {\n    if (this.pop_up) {\n      this.pop_up = false;\n    }\n\n    this.links = this.data.links();\n    const levels = this.data.to_open_levels();\n    const height = this.options.height;\n\n    const side_padding = (this.side_padding = 50);\n    const horizontal0_padding = 50;\n    const horizontal_padding = 150;\n    const col0_width = 250;\n    const col_width = 350;\n\n    const total_width = (this.total_width =\n      (_.keys(levels).length - 1) * col_width +\n      (_.keys(levels).length - 2) * horizontal_padding +\n      col0_width +\n      horizontal0_padding +\n      side_padding);\n\n    const yscale = scaleLinear()\n      .domain([0, this.data.root.value])\n      .range([0, height]);\n\n    const cycle_colors = i => {\n      return color(this.colors[i % this.colors.length]);\n    };\n\n    _.each(this.data.root.children, (node, i) => {\n      assign_colors_recursively(node, cycle_colors(i));\n    });\n\n    this.outer_html\n      .select(\".partition-diagram-outer-area\")\n      .style(\"width\", total_width + \"px\");\n\n    this.svg.attr(\"width\", total_width);\n\n    const vertical_placement_counters = _.chain(levels)\n      .keys()\n      .map(key => [key, +key * 30])\n      .fromPairs()\n      .value();\n\n    const horizontal_placement_counters = _.mapValues(levels, (vals, key) => {\n      return (\n        side_padding / 2 +\n        (+key === 0\n          ? 0\n          : col0_width +\n            horizontal0_padding +\n            (key - 1) * (col_width + horizontal_padding))\n      );\n    });\n\n    this.html.selectAll(\"div.header\").remove();\n\n    if (this.level_headers) {\n      this.html\n        .selectAll(\"div.header\")\n        .data(_.keys(levels).sort().reverse())\n        .enter()\n        .filter(d => d !== \"0\")\n        .append(\"div\")\n        .classed(\"header\", true)\n        .style(\"left\", (d, i) => horizontal_placement_counters[+d] + \"px\")\n        .style(\"width\", col_width + \"px\")\n        .html(d => {\n          return _.has(this.level_headers, d) ? this.level_headers[d] : \"\";\n        });\n    }\n\n    const html_func = this.options.html_func;\n\n    const html_content_join = this.html\n      .selectAll(\"div.partition-item\")\n      .data(\n        this.data.root.descendants().filter(d => d.open),\n        content_key\n      )\n      .style(\"height\", \"\")\n      .each(function (d) {\n        select(this)\n          .select(\"div.partition-item__title\")\n          .classed(\"right\", d.data.type === \"compressed\")\n          .html(html_func);\n      }); //reset the calculated heights\n    html_content_join.exit().remove();\n\n    const html_content_join_enter = html_content_join\n      .enter()\n      .append(\"div\")\n      .each(function (d) {\n        let sel = select(this);\n\n        if ((d.data.type === \"compressed\" && is_IE()) || d.value < 0) {\n          // partition-item__right-ie-fix: IE css for flex box and align-item are inconsistent, need an extra div\n          // between the .content div and the .partition-item__title div to (partially) fix vertical alignment\n\n          // partition-item__negative-title-backing: Used in blanking out the striped negative value background, improves readability\n          sel = sel\n            .append(\"div\")\n            .classed(\"partition-item__negative-title-backing\", d.value < 0)\n            .classed(\n              \"partition-item__right-ie-fix\",\n              d.data.type === \"compressed\" && is_IE()\n            );\n        }\n\n        sel\n          .append(\"div\")\n          .attr(\"tabindex\", 0)\n          .classed(\"partition-item__title\", true)\n          .classed(\"right\", d.data.type === \"compressed\")\n          .style(\"background-color\", this.background_color)\n          .html(html_func);\n      })\n      .attr(\"class\", d => {\n        let cls = \"partition-item\";\n        if (d === this.data.root) {\n          cls += \" root\";\n        }\n        return cls;\n      })\n      .style(\"border-bottom\", \"\")\n      .style(\"top\", d => {\n        if (_.isNull(d.parent)) {\n          return \"0px\";\n        }\n        const index = d.parent.children.indexOf(d);\n\n        if (index === 0) {\n          return d.parent.top + \"px\";\n        } else {\n          return (\n            d.parent.children[index - 0].top +\n            d.parent.children[index - 0].rendered_height +\n            \"px\"\n          );\n        }\n      })\n      .style(\"width\", d => {\n        d.width = d === this.data.root ? col0_width : col_width;\n        return d.width + \"px\";\n      });\n\n    html_content_join_enter\n      .merge(html_content_join)\n      .each(function (d) {\n        d.DOM = this;\n        d.scaled_height = yscale(Math.abs(d.value) || 1);\n        d.polygon_links = new Map();\n      })\n      .classed(\"partition-item--negative_value\", d => d.value < 0)\n      .style(\"left\", (d, i) => horizontal_placement_counters[d.depth] + \"px\")\n      .style(\"height\", d => {\n        d.rendered_height = Math.floor(d.scaled_height) + 1;\n        return d.rendered_height + \"px\";\n      })\n      .each(d => {\n        const item_node = select(d.DOM);\n        const title = item_node.select(\".partition-item__title\").node();\n\n        const text_is_bigger_then_item =\n          title.offsetHeight > d.scaled_height + 2;\n        item_node.classed(\n          \"partition-item--overflowing\",\n          text_is_bigger_then_item\n        );\n\n        item_node\n          .select(\".partition-item__title\")\n          .style(\n            \"background-color\",\n            text_is_bigger_then_item ? this.background_color : null\n          );\n\n        item_node\n          .select(\".partition-item__negative-title-backing\")\n          .style(\n            \"background-color\",\n            text_is_bigger_then_item ? null : this.background_color\n          );\n\n        // IE fixes, a bit hacky but that's how it is:\n        const font_size = 12;\n        item_node\n          .select(\".partition-item__right-ie-fix\")\n          .style(\"margin-top\", function (d) {\n            // use margin-top to fix vertical placement of +/-\n            const content_height = this.parentElement.style.pixelHeight;\n            if (text_is_bigger_then_item && content_height - font_size < 0) {\n              return content_height - font_size - 4 + \"px\";\n            } else {\n              return \"0px\";\n            }\n          })\n          .style(\"padding-top\", function (d) {\n            // use padding-top to fix vertical placement of +/-\n            const content_height = this.parentElement.style.pixelHeight;\n            if (!text_is_bigger_then_item) {\n              return content_height * 0.5 - font_size * 0.75 + \"px\";\n            } else {\n              return \"0px\";\n            }\n          });\n      })\n      .style(\"background-color\", d => {\n        return d.color;\n      })\n      .each(function (d) {\n        const level = d.depth;\n        const title = select(d.DOM).select(\".partition-item__title\").node();\n        const current_top = vertical_placement_counters[level];\n        const parent_top = d.parent ? d.parent.top : 0;\n        const diff = (title.offsetHeight - d.DOM.offsetHeight) / 2;\n        let top_vertical_margin;\n        if (d.parent && _.head(d.parent.children) !== d) {\n          top_vertical_margin = 10;\n        } else {\n          top_vertical_margin = 25;\n        }\n        if (diff > 0 && diff > 0.5 * top_vertical_margin) {\n          top_vertical_margin += diff;\n        }\n        const top = Math.max(parent_top, current_top);\n        const height = Math.max(\n          d.rendered_height,\n          d.DOM.offsetHeight,\n          title.offsetHeight\n        );\n        vertical_placement_counters[level] = top + height + top_vertical_margin;\n        d.top = top + top_vertical_margin;\n      })\n      .order();\n\n    const total_height = _.max(_.values(vertical_placement_counters)) * 1.01;\n    this.html.style(\"height\", total_height + \"px\");\n    this.svg.attr(\"height\", total_height);\n\n    const link_polygons = this.graph_area\n      .selectAll(\"polygon.partition-svg-link\")\n      .data(\n        _.filter(this.links, link => {\n          return (\n            link.source.open &&\n            link.target.open &&\n            !link.target.data.unhidden_children\n          );\n        }),\n        polygon_key\n      );\n\n    link_polygons.exit().remove();\n\n    link_polygons\n      .enter()\n      .append(\"polygon\")\n      .classed(\"partition-svg-link\", true)\n      .merge(link_polygons)\n      .each(function (d) {\n        d.source.polygon_links.set(d.target, select(this));\n      });\n\n    this.html\n      .selectAll(\"div.partition-item\")\n      .transition()\n      .duration(1000)\n      .style(\"top\", function (d) {\n        return d.top + \"px\";\n      })\n      .on(\"start\", d => {\n        if (d.children) {\n          d.height_of_all_children = sum(\n            d.children,\n            child => child.scaled_height || 0\n          );\n        }\n        if (d.parent && !d.data.unhidden_children) {\n          this.add_polygons(d);\n        }\n      });\n\n    if (this.dont_fade.length > 0) {\n      this.fade();\n    }\n\n    if (!_.isUndefined(this.unmagnify_all_popup)) {\n      this.remove_unmagnify_all_button();\n    }\n    if (this.are_any_children_magnified()) {\n      this.add_unmagnify_all_button();\n    }\n  }\n\n  add_polygons(target) {\n    const source = target.parent;\n    if (\n      target ===\n      source.children.filter(\n        c => _.isUndefined(c.no_polygon) || !c.no_polygon\n      )[0]\n    ) {\n      // (re)set vertical counter to source.top if drawing first polygon for this source\n      source.vertical_counter = source.top;\n    }\n    if (!target.open || !source.open) {\n      return;\n    }\n    const target_x = target.DOM.offsetLeft;\n    const target_y = target.top;\n    const target_height = target.rendered_height;\n    const source_x = source.DOM.offsetLeft + source.width;\n    const source_height =\n      (source.rendered_height * target.scaled_height) /\n      source.height_of_all_children;\n    const left_side_padding = this.side_padding / 2;\n    let tr, tl, br, bl, klass;\n    tr = [target_x, target_y];\n    tl = [source_x, source.vertical_counter];\n    br = [target_x, target_y + target_height];\n    bl = [source_x, tl[1] + source_height];\n\n    klass =\n      bl[1] - tl[1] <= 1 ? \"tiny\" : bl[1] - tl[1] < 5 ? \"medium\" : \"large\";\n\n    const gradient_def_id =\n      target.color.toString().replace(/\\(|\\)|, /g, \"-\") + \"grad\";\n    if (!this.defs.select(\"#\" + gradient_def_id).node()) {\n      const gradient_def = this.defs\n        .append(\"linearGradient\")\n        .attr(\"id\", gradient_def_id);\n\n      gradient_def\n        .append(\"stop\")\n        .attr(\"offset\", \"5%\")\n        .attr(\"stop-color\", target.color)\n        .attr(\"stop-opacity\", \"0.3\");\n\n      gradient_def\n        .append(\"stop\")\n        .attr(\"offset\", \"95%\")\n        .attr(\"stop-color\", target.color);\n    }\n\n    source.polygon_links\n      .get(target)\n      .classed(klass, true)\n      .classed(\"root-polygon\", d => d.source.parent === null)\n      .style(\"fill\", target.color)\n      .attr(\"points\", function (d) {\n        if (select(this).attr(\"points\")) {\n          return select(this).attr(\"points\");\n        } else if (d.source.parent === null) {\n          return `${tl} ${bl} ${[bl[0], bl[1] + 0.1]} ${[\n            left_side_padding,\n            bl[1] + 0.1,\n          ]} ${[left_side_padding, tl[1] - 0.1]} ${[tl[0], tl[1] - 0.1]}`;\n        } else {\n          return `${tl} ${bl} ${bl} ${tl}`;\n        }\n      })\n      .transition()\n      .duration(1000)\n      .attr(\"points\", function (d) {\n        if (d.source.parent === null) {\n          return `${tr} ${br} ${[bl[0], bl[1] + 0.1]} ${[\n            left_side_padding,\n            bl[1] + 0.1,\n          ]} ${[left_side_padding, tl[1] - 0.1]} ${[tl[0], tl[1] - 0.1]}`;\n        } else {\n          return `${tr} ${br} ${bl} ${tl}`;\n        }\n      })\n      .attr(\"stroke\", \"url(#\" + gradient_def_id + \")\");\n\n    source.vertical_counter += source_height;\n  }\n\n  fade(data) {\n    const to_fade = _.filter(\n      data || this.data.root.descendants(),\n      d => !_.includes(this.dont_fade, d)\n    );\n    this.svg\n      .selectAll(\"polygon.partition-svg-link\")\n      .filter(d => _.includes(to_fade, d.target))\n      .classed(\"faded\", true)\n      .classed(\"highlighted\", false);\n    this.html\n      .selectAll(\"div.partition-item\")\n      .filter(d => _.includes(to_fade, d))\n      .classed(\"faded\", true);\n  }\n\n  unfade(data) {\n    if (this.dont_fade.length > 0) {\n      data = data || this.dont_fade;\n    } else {\n      data = data || this.data.root.descendants();\n    }\n    const links = _.chain(data)\n      .filter(source => _.isArray(source.children))\n      .map(source => _.map(source.children, target => ({ source, target })))\n      .flatten(true)\n      .value();\n    this.graph_area\n      .selectAll(\"polygon.partition-svg-link\")\n      .data(links, polygon_key)\n      .filter(d => (links.length > 0 ? _.includes(links, d) : true))\n      .classed(\"faded\", false)\n      .classed(\"highlighted\", false);\n\n    // The above doesn't select root polygons. If the data contains root, unfade root polygons here\n    if (_.some(data, d => d.parent === null)) {\n      this.graph_area\n        .selectAll(\"polygon.partition-svg-link.root-polygon\")\n        .classed(\"faded\", false)\n        .classed(\"highlighted\", false);\n    }\n\n    this.html\n      .selectAll(\"div.partition-item\")\n      .data(data, content_key)\n      .filter(d => (data.length > 0 ? _.includes(data, d) : true))\n      .classed(\"faded\", false);\n  }\n\n  // Same as unfade, but more discerning of polygons selected\n  unfade_popup_parents(data) {\n    if (this.dont_fade.length > 0) {\n      data = data || this.dont_fade;\n    } else {\n      data = data || this.data.root.descendants();\n    }\n    const lowest_node_id_ancestry = data[0].id_ancestry;\n    const links = _.chain(data)\n      .filter(source => _.isArray(source.children))\n      .map(source => _.map(source.children, target => ({ source, target })))\n      .flatten(true)\n      .filter(link => {\n        const split_and_reverse_id_ancestry = id_ancestry =>\n          _.reverse(_.split(id_ancestry, \"-\"));\n\n        const lowest_node_id_ancestry_chunks = split_and_reverse_id_ancestry(\n          lowest_node_id_ancestry\n        );\n        const link_target_id_ancestry_chunks = split_and_reverse_id_ancestry(\n          link.target.id_ancestry\n        );\n\n        const longer_of_the_id_chunks =\n          lowest_node_id_ancestry_chunks.length >=\n          link_target_id_ancestry_chunks.length\n            ? lowest_node_id_ancestry_chunks\n            : link_target_id_ancestry_chunks;\n        const shorter_of_the_id_chunks =\n          lowest_node_id_ancestry_chunks.length >=\n          link_target_id_ancestry_chunks.length\n            ? link_target_id_ancestry_chunks\n            : lowest_node_id_ancestry_chunks;\n\n        const target_link_is_in_branch_of_lowest_node = _.chain(\n          shorter_of_the_id_chunks\n        )\n          .map((id_chunk, ix) => id_chunk === longer_of_the_id_chunks[ix])\n          .reduce((memo, bool) => memo && bool, true)\n          .value();\n\n        return target_link_is_in_branch_of_lowest_node;\n      })\n      .value();\n\n    const unfade_parent_polygons = polygon_selector => {\n      this.graph_area\n        .selectAll(polygon_selector)\n        .data(links, polygon_key)\n        .filter(d => (links.length > 0 ? _.includes(links, d) : true))\n        .classed(\"faded\", false)\n        .classed(\"highlighted\", true);\n    };\n    unfade_parent_polygons(\"polygon.partition-svg-link.root-polygon\");\n    unfade_parent_polygons(\"polygon.partition-svg-link\");\n\n    this.html\n      .selectAll(\"div.partition-item\")\n      .data(data, content_key)\n      .filter(d => (data.length > 0 ? _.includes(data, d) : true))\n      .classed(\"faded\", false);\n  }\n\n  render_popup(_node) {\n    throw new Error(\"Not implemented\");\n  }\n\n  add_pop_up(d) {\n    if (_.isUndefined(d)) {\n      return;\n    }\n    this.fade();\n    select(d.DOM).node().focus();\n    const content = select(d.DOM);\n    let arrow_at_top;\n    let pop_up_top;\n    const pop_up = content\n      .append(\"div\")\n      .classed(\"partition-popup\", true)\n      .style(\"border\", `3px solid ${d.color}`)\n      .style(\"left\", 0.9 * d.DOM.offsetWidth + \"px\");\n    // .style(\"color\", d.color);\n\n    this.render_popup(d, pop_up.node());\n\n    pop_up.style(\"top\", function (d) {\n      let calculated_middle = (d.DOM.offsetHeight - this.offsetHeight) / 2;\n      arrow_at_top = d.DOM.offsetTop + calculated_middle < 0;\n      if (arrow_at_top) {\n        calculated_middle = -30;\n      }\n      pop_up_top = calculated_middle;\n      return calculated_middle + \"px\";\n    });\n\n    // Pointer triangle made with css\n    const popup_pointer = pop_up\n      .append(\"div\")\n      .attr(\"class\", \"popup-pointer\")\n      .style(\"visibility\", \"hidden\");\n\n    const pointer_height = popup_pointer.node().offsetHeight;\n\n    popup_pointer\n      .style(\n        \"top\",\n        -pop_up_top + d.DOM.offsetHeight / 2 - pointer_height / 2 - 3 + \"px\"\n      )\n      .style(\"visibility\", \"visible\");\n\n    const absolute_pop_up_left = d.DOM.offsetLeft + pop_up.node().offsetLeft;\n    window.scroll(absolute_pop_up_left, window.pageYOffset);\n\n    const to_be_highlighted = _.uniqBy(d.ancestors().concat(d.descendants()));\n    this.unfade_popup_parents(to_be_highlighted);\n    this.pop_up = d;\n  }\n  remove_pop_up() {\n    select(this.pop_up.DOM).select(\".partition-popup\").remove();\n    select(this.pop_up.DOM).node().focus();\n    this.fade();\n    this.unfade();\n    this.svg\n      .selectAll(\"polygon.partition-svg-link\")\n      .classed(\"highlighted\", false);\n    this.pop_up = false;\n  }\n  keydown_dispatch = () => {\n    if (event.keyCode === 13) {\n      this.click_dispatch();\n    }\n  };\n  click_dispatch = () => {\n    // hold a reference to the current target\n    const target = select(event.target);\n    // get a reference to the content\n    let content = event.target.closest(\".partition-item\");\n    if (_.isNull(content)) {\n      if (target.classed(\"unmagnify-all\")) {\n        this.unmagnify_all();\n        this.render();\n      } else if (this.pop_up) {\n        this.remove_pop_up();\n      }\n      // we're done with this event, ensure no further propogation\n      event.stopImmediatePropagation();\n      event.preventDefault();\n      return;\n    }\n    if (\n      this.pop_up &&\n      !this.html.node().querySelector(\".partition-popup\").contains(event.target)\n    ) {\n      this.remove_pop_up();\n      event.stopImmediatePropagation();\n      event.preventDefault();\n      return;\n    }\n    content = select(content);\n    const d = content.datum();\n    if (d.DOM.className.includes(\"faded\")) {\n      if (this.pop_up) {\n        this.remove_pop_up();\n      }\n      event.stopImmediatePropagation();\n      event.preventDefault();\n      return;\n    }\n    if (\n      d.data.hidden_children ||\n      d.data.unhidden_children ||\n      this.data.collapsed(d)\n    ) {\n      if (d.data.unhidden_children) {\n        this.data.show_partial_children(d.parent);\n      } else if (d.data.hidden_children) {\n        this.data.show_all_children(d.parent);\n      } else if (this.data.collapsed(d)) {\n        this.data.unhide_all_children(d);\n        this.magnify(d);\n      }\n      this.render();\n      event.stopImmediatePropagation();\n      event.preventDefault();\n      return;\n    }\n\n    if (target.classed(\"partition-link-out\")) {\n      //do nothing and let route be processed\n      return;\n    } else if (target.classed(\"magnify\")) {\n      this.remove_pop_up();\n      if (d.magnified) {\n        this.unmagnify(d);\n      } else {\n        this.magnify(d);\n      }\n      this.render();\n    } else if (d !== this.pop_up) {\n      if (d === this.data.root && this.options.should_root_have_popup) {\n        this.add_pop_up(d);\n      } else {\n        this.add_pop_up(d);\n      }\n    }\n    event.stopImmediatePropagation();\n    event.preventDefault();\n  };\n  unmagnify_all() {\n    if (this.pop_up) {\n      this.remove_pop_up();\n    }\n\n    _.each(this.data.root.children, node => {\n      if (this.data.magnified(node)) {\n        this.data.unmagnify(node);\n      }\n    });\n    if (this.should_remove_unmagnify_all_button()) {\n      this.remove_unmagnify_all_button();\n    }\n  }\n  unmagnify(node) {\n    this.data.unmagnify(node);\n    if (this.should_remove_unmagnify_all_button()) {\n      this.remove_unmagnify_all_button();\n    }\n  }\n  magnify(node) {\n    this.data.magnify(node);\n    if (_.isUndefined(this.unmagnify_all_popup)) {\n      this.add_unmagnify_all_button();\n    }\n  }\n  add_unmagnify_all_button() {\n    this.unmagnify_all_popup = this.html\n      .append(\"div\")\n      .html(\"partition_unfocus_all_popup\");\n  }\n  should_remove_unmagnify_all_button() {\n    return (\n      !_.isUndefined(this.unmagnify_all_popup) &&\n      !this.are_any_children_magnified()\n    );\n  }\n  are_any_children_magnified() {\n    return _.chain(this.data.root.children)\n      .map(node => node.magnified)\n      .some()\n      .value();\n  }\n  remove_unmagnify_all_button() {\n    this.unmagnify_all_popup.remove();\n    this.unmagnify_all_popup = undefined;\n  }\n  destructor() {\n    // probable override?\n    // consumer needs to call manually\n  }\n}\n\nexport class ManualPartitionDiagram extends BasePartitionDiagram {\n  constructor(container, options) {\n    super(container, options);\n    this.popupCallback = this.options.popupCallback;\n  }\n  render_popup(node, container) {\n    this.popupCallback(node, container);\n  }\n}\n\nexport class PartitionWithReactPopup extends BasePartitionDiagram {\n  // can remove this if not using react-based pop-ups\n  constructor(container, options) {\n    super(container, options);\n    this.reactAdapter = new ReactContentRenderer();\n  }\n  remove_pop_up() {\n    this.reactAdapter.unmountAtNode(this.pop_up.DOM);\n    super.remove_pop_up();\n  }\n  render_popup(node, container) {\n    const PopupComponent = this.options.PopupComponent;\n    const popupElement = React.createElement(PopupComponent, { node });\n    this.reactAdapter.render(popupElement, container);\n  }\n  destructor() {\n    super.destructor();\n    this.reactAdapter.unmountAll();\n  }\n}\n// export const PartitionWithReactPopup = _PartitionWithReactPopup;\n","import faker from \"faker\";\n\nfaker.seed(123);\nfaker.setLocale(\"en_CA\");\n\nfaker.seed(123);\nfaker.setLocale(\"en_CA\");\n\nexport interface RawNode {\n  id: string;\n  name: string;\n  amount?: number;\n  children?: Node[];\n}\n\nfunction generateNode(level: number, maxLevel: number): RawNode {\n  const node: Node = {\n    id: faker.datatype.uuid(),\n    name: faker.name.findName(),\n  };\n\n  if (level < maxLevel) {\n    const childrenCount = faker.datatype.number({ min: 1, max: 5 * level });\n    node.children = Array.from({ length: childrenCount }, () =>\n      generateNode(level + 1, maxLevel)\n    );\n  } else {\n    node.amount = faker.datatype.number({ min: 1, max: 100 });\n  }\n\n  return node;\n}\n\nfunction generateHierarchy(): RawNode {\n  const root: Node = {\n    id: faker.datatype.uuid(),\n    name: \"Root\",\n    children: [],\n  };\n\n  const topLevelCount = faker.datatype.number({ min: 4, max: 10 });\n  root.children = Array.from({ length: topLevelCount }, () =>\n    generateNode(1, 4)\n  );\n  //example negative child,\n  root.children.push({\n    id: faker.datatype.uuid(),\n    name: \"Negative Example\",\n    children: [\n      {\n        id: faker.datatype.uuid(),\n        name: \"Negative Child\",\n        children: [\n          {\n            id: faker.datatype.uuid(),\n            name: \"Positive Grandchild\",\n            amount: 200,\n          },\n          {\n            id: faker.datatype.uuid(),\n            name: \"Negative Grandchild\",\n            amount: -850,\n          },\n        ],\n      },\n    ],\n  });\n\n  return root;\n}\n\nexport const data = generateHierarchy();\n// console.log(JSON.stringify(hierarchy, null, 2));\n\nwindow.data = data;\n","import { hierarchy } from \"d3-hierarchy\";\nimport { select } from \"d3-selection\";\nimport _ from \"lodash\";\n\nimport React, { useEffect, useRef } from \"react\";\n\nimport { ManualPartitionDiagram } from \"PartitionComponent/PartitionDiagram\";\n\nimport {\n  post_traversal_value_set,\n  absolute_value_sort,\n} from \"PartitionComponent/util\";\n\nimport { data as rawDataRoot, RawNode } from \"./data\";\n\nexport default function PlainExample() {\n  return (\n    <DumbComponent title=\"Plain Example\">\n      <PartitionComponent />\n    </DumbComponent>\n  );\n}\n\ninterface ProcessedNode {\n  data: RawNode;\n  value: number;\n  children: Array<ProcessedNode>;\n}\n\nfunction PartitionComponent() {\n  //   return <div> {JSON.stringify(data)} </div>;\n  const node = useRef(null);\n  useEffect(() => {\n    renderDiagram({ node: node.current });\n  }, []);\n  return <div ref={node} />;\n}\n\nfunction DumbComponent({ title, children }) {\n  return (\n    <div className=\"partition-page-root\">\n      <div className=\"partition-container\">\n        <h1 className=\"partition-title\">{title}</h1>\n      </div>\n      {children}\n    </div>\n  );\n}\n\n// NO REACT BELOW THIS POINT\n\nfunction renderDiagram({ node }) {\n  /* \n    THIS IS THE NON-REACT ENTRYPOINT\n  */\n  const containerSelection = select(node);\n  const partitionDiagram = new ManualPartitionDiagram(containerSelection, {\n    popupCallback: popupHtmlForNode,\n    height: 700,\n  });\n\n  // todo: shape data\n  const partitionData = getData();\n\n  partitionDiagram.configure_then_render({\n    data: partitionData,\n    data_wrapper_node_rules: data_wrapper_node_rules,\n    dont_fade: [],\n    html_func: htmlForNode,\n    should_root_have_popup: true,\n    // formatter: node => ` (${node.value})`,\n    level_headers: [null, \"VP\", \"Director General\", \"Director\", \"Employee\"],\n    colors: branchColors,\n    background_color: backgroundColor,\n  });\n}\n\nfunction popupHtmlForNode(node: ProcessedNode, container: HTMLElement) {\n  const html = `\n    <div className=\"consumer-popup\">\n        <div>${node.data.name}</div>\n        <div>${node.value}</div>\n    </div>\n  `;\n  container.innerHTML = html;\n}\n\nfunction htmlForNode(node: ProcessedNode) {\n  return `<span style=\"font-size: 14px;\">${node.data.name}</span>`;\n}\n\nconst branchColors = [\n  // partition is colored by branch, not by layer\n  \"#195596\", // blue\n  \"#117078\", // dark teal\n  \"#862552\", // pink\n  \"#554A9E\", // purple\n  \"#1B793A\", // green\n  \"#555B62\", // grey\n];\nconst backgroundColor = \"#26374A\";\n\nfunction data_wrapper_node_rules(node) {\n  node.__value__ = node.value;\n  node.open = true;\n  if (node.data.root) {\n    node.how_many_to_show = _node => [_node.children, []];\n  } else if (!_.isEmpty(node.children)) {\n    const root_value = _.last(node.ancestors()).value;\n\n    node.how_many_to_show = function (_node) {\n      if (_node.children.length === 2) {\n        return [_node.children, []];\n      }\n      const show = [_.head(_node.children)];\n      const hide = _.tail(_node.children);\n      const unhide = _.filter(\n        hide,\n        __node => Math.abs(__node.value) > root_value / 50\n      );\n      return [show.concat(unhide), _.difference(hide, unhide)];\n    };\n  }\n}\n\nfunction getData() {\n  const valueFunc = node => node.amount;\n  return hierarchy(rawDataRoot, node => node.children)\n    .eachAfter(node => {\n      post_traversal_value_set(node, valueFunc);\n    })\n    .sort(absolute_value_sort);\n}\n","import React from \"react\";\n\nimport PlainExample from \"Example/PlainExample\";\n\nfunction App() {\n  return <PlainExample />;\n}\n\nexport default App;\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport \"./index.css\";\nimport { BrowserRouter as Router } from \"react-router-dom\";\n\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <Router>\n      <App />\n    </Router>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}